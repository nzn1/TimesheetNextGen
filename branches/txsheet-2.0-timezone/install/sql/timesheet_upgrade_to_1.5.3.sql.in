CREATE TABLE IF NOT EXISTS `configuration` (
  `name` varchar(32) NOT NULL,
  `value` tinytext NOT NULL,
  PRIMARY KEY (`name`)
)

/* copy stuff from active config to new configuration table */
insert into configuration values ('version','1.5.3');
insert into configuration values ('timezone',(select (timezone) from tsx_config where config_set_id=1));
insert into configuration values ('locale',(select (locale) from tsx_config where config_set_id=1));
insert into configuration values ('startPage',(select (startPage) from tsx_config where config_set_id=1));
insert into configuration values ('weekstartday',(select (weekstartday) from tsx_config where config_set_id=1));
insert into configuration values ('project_items_per_page',(select (project_items_per_page) from tsx_config where config_set_id=1));
insert into configuration values ('task_items_per_page',(select (task_items_per_page) from tsx_config where config_set_id=1));
insert into configuration values ('simpleTimesheetLayout',(select (simpleTimesheetLayout) from tsx_config where config_set_id=1));

insert into configuration values ('useLDAP',(select (useLDAP) from tsx_config where config_set_id=1));
insert into configuration values ('LDAPurl',(select concat((select (LDAPScheme) from tsx_config where config_set_id=1),"://",(select (LDAPHost) from tsx_config where config_set_id=1),":",(select (LDAPPort) from tsx_config where config_set_id=1),"/")));
insert into configuration values ('LDAPProtocolVersion',(select (LDAPProtocolVersion) from tsx_config where config_set_id=1));
insert into configuration values ('LDAPBaseDN',(select (LDAPBaseDN) from tsx_config where config_set_id=1));
insert into configuration values ('LDAPFilter',(select (LDAPFilter) from tsx_config where config_set_id=1));
insert into configuration values ('LDAPSearchScope',(select (LDAPSearchScope) from tsx_config where config_set_id=1));
insert into configuration values ('LDAPUsernameAttribute',(select (LDAPUsernameAttribute) from tsx_config where config_set_id=1));
insert into configuration values ('LDAPFallback',(select (LDAPFallback) from tsx_config where config_set_id=1));
insert into configuration values ('LDAPReferrals',(select (LDAPReferrals) from tsx_config where config_set_id=1));
insert into configuration values ('LDAPBindUsername',(select (LDAPBindUsername) from tsx_config where config_set_id=1));
insert into configuration values ('LDAPBindPassword',(select (LDAPBindPassword) from tsx_config where config_set_id=1));
insert into configuration values ('LDAPBindByUser',(select (LDAPBindByUser) from tsx_config where config_set_id=1));
/* new fields */
ALTER TABLE tsx_user  ADD   employee_type enum('Contractor','Employee') NOT NULL DEFAULT 'Employee';
ALTER TABLE tsx_user  ADD supervisor int(11) DEFAULT NULL;
ALTER TABLE __TABLE_PREFIX__config  ADD  aclExpenses enum('Admin','Mgr','Basic','None') NOT NULL DEFAULT 'Basic', aclECategories enum('Admin','Mgr','Basic','None') NOT NULL DEFAULT 'Basic', aclTApproval enum('Admin','Mgr','Basic','None') NOT NULL DEFAULT 'Basic',
--
-- Table structure for table `expense`
--

CREATE TABLE IF NOT EXISTS `tsx_expense` (
  `eid` int(5) NOT NULL AUTO_INCREMENT,
  `cat_id` int(5) DEFAULT NULL,
  `proj_id` int(11) DEFAULT NULL,
  `user_id` varchar(32) DEFAULT NULL,
  `client_id` int(8) DEFAULT NULL,
  `billable` enum('Billable','Internal','Personal') DEFAULT 'Billable',
  `amount` decimal(8,2) NOT NULL DEFAULT '0.00',
  `description` varchar(64) DEFAULT NULL,
  `date` datetime DEFAULT NULL,
  `status` enum('Open','Submitted','Approved') NOT NULL DEFAULT 'Open',
  PRIMARY KEY (`eid`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=17 ;

--
-- Table structure for table `expense_category`
--

CREATE TABLE IF NOT EXISTS `tsx_category` (
  `cat_id` int(8) NOT NULL AUTO_INCREMENT,
  `description` varchar(64) NOT NULL,
  PRIMARY KEY (`cat_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 COMMENT='ts1_expense_category' AUTO_INCREMENT=8 ;

--
-- Table structure for table `__TABLE_PREFIX__std_tasks`
--

CREATE TABLE IF NOT EXISTS `__TABLE_PREFIX__std_tasks` (
  `task_id` int(8) NOT NULL AUTO_INCREMENT,
  `name` varchar(127) DEFAULT NULL,
  `description` text,
  PRIMARY KEY (`task_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=187 ;

--
-- Table structure for table `ts1_utctimes`
--

CREATE TABLE IF NOT EXISTS `__TABLE_PREFIX__utctimes` (
  `uid` varchar(32) NOT NULL DEFAULT '',
  `start_time` datetime NOT NULL DEFAULT '1970-01-01 00:00:00',
  `end_time` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
  `timezone` varchar(30) NOT NULL,
  `duration` smallint(5) unsigned DEFAULT NULL,
  `trans_num` int(11) NOT NULL AUTO_INCREMENT,
  `proj_id` int(11) NOT NULL DEFAULT '1',
  `task_id` int(11) NOT NULL DEFAULT '1',
  `log_message` text,
  `status` enum('Open','Submitted','Approved') NOT NULL DEFAULT 'Open',
  UNIQUE KEY `trans_num` (`trans_num`),
  KEY `uid` (`uid`,`trans_num`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=237 ;



--
-- Table structure for table `ts1_usertz`
--

CREATE TABLE IF NOT EXISTS `__TABLE_PREFIX__usertz` (
  `username` varchar(32) NOT NULL DEFAULT '',
  `level` int(11) NOT NULL DEFAULT '0',
  `password` varchar(41) NOT NULL DEFAULT '',
  `first_name` varchar(64) NOT NULL DEFAULT '',
  `last_name` varchar(64) NOT NULL DEFAULT '',
  `email_address` varchar(63) NOT NULL DEFAULT '',
  `status` enum('INACTIVE','ACTIVE') NOT NULL DEFAULT 'ACTIVE',
  `time_stamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `uid` int(11) NOT NULL AUTO_INCREMENT,
  `timezone` varchar(30) NOT NULL,
  `supervisor` int(11) DEFAULT NULL,
  `employee_type` enum('Contractor','Employee') NOT NULL DEFAULT 'Employee',
  `session` varchar(32) DEFAULT NULL,
  PRIMARY KEY (`username`),
  KEY `uid` (`uid`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=9 ;

--
